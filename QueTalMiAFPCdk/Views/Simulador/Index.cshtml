@using System.Globalization
@{
    ViewData["Title"] = "Simula tus Ganancias";
    ViewData["Description"] = "Aquí podrás simular las ganancias en pesos que pudiste obtener según las rentabilidades resultantes de cada AFP en cierto periodo de tiempo.";
    ViewData["LogoutRedirect"] = Url.Action("Index", "Simulador");
}

@section Head {
    <link rel="stylesheet" href="~/css/Simulador.css" asp-append-version="true" />
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" /></noscript>
}

@section Scripts {
    <script src="https://cdn.amcharts.com/lib/4/core.js" defer></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js" defer></script>
    <script src="https://www.amcharts.com/lib/4/lang/es_ES.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.es.min.js" defer></script>
    <script src="~/js/Simulador.js" asp-append-version="true" defer></script>
}

<h1>@ViewData["Title"]</h1>

<p class="mt-3 text-muted">
    Aquí podrás simular las ganancias en pesos que pudiste obtener
    según las rentabilidades resultantes de cada AFP en cierto periodo de tiempo.
</p>

<hr />

<h5>Cuenta de Cotizaciones Obligatorias</h5>

<p class="text-muted">
    Para obtener las ganancias o pérdidas que pudiste generar, favor ingresa
    a continuación tu sueldo mensual imponible, el día aproximado en que tu empleador
    paga tus cotizaciones y el rango de fechas que se utilizará para determinar la
    rentabilidad final:
</p>

<div class="w-100 mt-3">
    <table class="w-100">
        <tr>
            <td class="pl-0 w-50">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text" for="sueldoMensual">Sueldo Imp.</span>
                    </div>
                    <input value="@ViewBag.SueldoImponible" type="text" class="form-control" id="sueldoMensual" style="width: 5rem;">
                </div>
            </td>
            <td class="pr-0 w-50">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text" for="diaPagoCotiz">Pago Cotiz.</span>
                    </div>
                    <select class="custom-select" id="diaPagoCotiz" style="width: 1rem;">
                        @for (int i = 1; i <= 31; i++) {
                            @if (i != ViewBag.DiaCotizacion) {
                                <option value="@i">@i</option>

                            } else {
                                <option value="@i" selected>@i</option>
                            }
                        }
                    </select>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2" class="px-0 @((User.Identity == null || !User.Identity.IsAuthenticated) ? "pt-2": "")">
                <div style="display: grid; grid-template-columns: 80% 20%;">
                    <div style="grid-column: 1; position: relative;" class="mr-2">
                        <div class="input-group input-daterange">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="fa-regular fa-calendar"></i>
                                </span>
                            </div>

                            <input value="@ViewBag.UltimaFechaTodosValoresCuota.AddYears(-1).ToString("dd/MM/yyyy", CultureInfo.InvariantCulture)" type="text" class="form-control inputFiltrarRent" name="fechaInicio" id="fechaInicio" />
                            <div class="input-group-append input-group-prepend">
                                <span class="input-group-text">
                                    <label style="margin-bottom:0px;">al</label>
                                </span>
                            </div>

                            <input value="@ViewBag.UltimaFechaTodosValoresCuota.ToString("dd/MM/yyyy", CultureInfo.InvariantCulture)" type="text" class="form-control inputFiltrarRent" name="fechaFinal" id="fechaFinal" />
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    <i class="fa-regular fa-calendar"></i>
                                </span>
                            </div>
                        </div>
                        @if (User.Identity == null || !User.Identity.IsAuthenticated)
                        {
                            <div class="overlay" data-toggle="tooltip" data-placement="top" data-html="true" title="<span><span><u>Rango de Fechas</u></span><br/>Inicia sesión para desbloquear esta función<br/><span>¡Es gratis! 😊</span></span>">
                                <a href="/login?redirect=@(Url.Action("Index", "Simulador"))" style="font-size: 0.8rem;" class="btn btn-primary py-1 px-4">
                                    ¡Iniciar Sesión!
                                </a>
                            </div>
                        }
                    </div>
                    <div style="grid-column: 2;">
                        <button id="btnFiltrarFechas" type="button" style="width:100%;" class="btn btn-primary" onclick="btnFiltrarGanancias()">
                            <span style="display:none;" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            <div style="display:inline-block;">Filtrar</div>
                        </button>
                    </div>
                </div>
            </td>
        </tr>
    </table>
</div>

<div class="card mb-3 mt-2" style="border-bottom-width: 0;">
    <div class="card-header pt-0 pb-0" id="headingGPFiltrosAvanzados">
        <button style="font-size: 0.8rem" class="btn btn-block text-left btnNoShadow p-1 text-muted" type="button" data-toggle="collapse" data-target="#collapseGPFiltrosAvanzados" aria-expanded="false" aria-controls="collapseGPFiltrosAvanzados">
            Filtros Avanzados
            <i class="fa-solid fa-chevron-down float-right fa-lg" style="margin-top:0.6em;"></i>
            <i class="fa-solid fa-chevron-up float-right fa-lg" style="margin-top:0.6em; display:none;"></i>
        </button>
    </div>
    <div id="collapseGPFiltrosAvanzados" class="collapse">
        <div class="card-body p-1">
            <table class="w-100">
                <tr>
                    <td class="w-50">
                        <div class="input-group">
                            <div class="input-group-prepend w-50">
                                <p class="input-group-text text-truncate w-100 text-muted" style="font-size: 0.8rem;" for="ahorroInicialMaximo">Ahorro Inicial Máximo:</p>
                            </div>
                            <input value="@ViewBag.AhorroInicialMaximo" style="font-size: 0.8rem;" type="text" class="form-control w-50 text-muted" id="ahorroInicialMaximo" />
                        </div>
                    </td>
                    <td class="w-50">
                        <div class="input-group">
                            <div class="input-group-prepend w-50">
                                <p class="input-group-text text-truncate w-100 text-muted" style="font-size: 0.8rem;" for="efectuarSimulacionCada">Efectuar Simulación Cada:</p>
                            </div>
                            <input value="@ViewBag.EfectuarSimulacionCada" style="font-size: 0.8rem;" type="text" class="form-control w-50 text-muted" id="efectuarSimulacionCada" />
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

<ul class="nav nav-tabs" id="TabGPFondos" role="tablist">
    @foreach(string fondo in "A,B,C,D,E".Split(","))
    {
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="TabGPFondo@(fondo)" data-toggle="tab" data-target="#ContGPFondo@(fondo)" type="button" role="tab" aria-controls="GPFondo@(fondo)" aria-selected="false">Fondo @(fondo)</button>
        </li>
    }
</ul>
<div class="tab-content p-1 mb-1" id="TabContentGPFondos">
    @foreach(string fondo in "A,B,C,D,E".Split(","))
    {
        <div class="tab-pane fade" id="ContGPFondo@(fondo)" role="tabpanel" aria-labelledby="TabGPFondo@(fondo)">
            <div class="chartSimulacion" id="chartGananPesos@(fondo)"></div>
        </div>
    }
</div>
<!--
foreach (string fondo in new List<string>() { "A", "B", "C", "D", "E" }) {
    <div class="card mb-3 (fondo == "A" ? "mt-3" : "")">
        <div class="card-header" id="headingGPFondo(fondo)">
            <button style="font-size: 0.80rem;" class="btn btn-block text-center btnNoShadow" type="button" data-toggle="collapse" data-target="#collapseGPFondo(fondo)" aria-expanded="false" aria-controls="collapseGPFondo(fondo)">
                CUENTA DE COTIZACIONES OBLIGATORIAS - FONDO (fondo)
                <i class="fa-solid fa-chevron-down float-right fa-lg" style="margin-top:0.6em;"></i>
                <i class="fa-solid fa-chevron-up float-right fa-lg" style="margin-top:0.6em; display:none;"></i>
            </button>
        </div>
        <div id="collapseGPFondo(fondo)" class="collapse">
            <div class="card-body pt-0">
                <div class="chartSimulacion" id="chartGananPesos(fondo)"></div>
            </div>
        </div>
    </div>
}
-->
<!--
<hr />
foreach (string fondo in new List<string>() { "A", "B", "C", "D", "E" }) {
    <div class="card mb-3 (fondo == "A" ? "mt-3" : "")">
        <div class="card-header" id="headingCAVFondo(fondo)">
            <button class="btn btn-block text-center btnNoShadow" type="button" data-toggle="collapse" data-target="#collapseCAVFondo(fondo)" aria-expanded="false" aria-controls="collapseCAVFondo(fondo)">
                CUENTA DE AHORRO VOLUNTARIO - CUENTA 2 - FONDO (fondo)
                <i class="fa-solid fa-chevron-down float-right fa-lg" style="margin-top:0.6em;"></i>
                <i class="fa-solid fa-chevron-up float-right fa-lg" style="margin-top:0.6em; display:none;"></i>
            </button>
        </div>
        <div id="collapseCAVFondo(fondo)" class="collapse">
            <div class="card-body pt-0">
                <div class="chartSimulacion" id="chartCAV(fondo)"></div>
            </div>
        </div>
    </div>
}
-->
